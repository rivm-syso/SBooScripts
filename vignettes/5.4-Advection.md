Advection
================
Jaap Slootweg, Joris Quik
2024-02-13

# Advection

This vignette demonstrates the implementation of the advective flows of
air and water in SimpleBox (SB). An advective flow in the context of SB
is the massflow of a matrix (air, water, ) from one box to another,
where either the subcompartment or scale is different.

``` r
source("baseScripts/initTestWorld.R")
```

    ## ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
    ## ✔ dplyr     1.1.3     ✔ readr     2.1.4
    ## ✔ forcats   1.0.0     ✔ stringr   1.5.0
    ## ✔ ggplot2   3.4.3     ✔ tibble    3.2.1
    ## ✔ lubridate 1.9.3     ✔ tidyr     1.3.0
    ## ✔ purrr     1.0.2     
    ## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
    ## ✖ dplyr::filter() masks stats::filter()
    ## ✖ dplyr::lag()    masks stats::lag()
    ## ℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors
    ## 
    ## Attaching package: 'ggdag'
    ## 
    ## 
    ## The following object is masked from 'package:stats':
    ## 
    ##     filter
    ## 
    ## 
    ## 
    ## Attaching package: 'rlang'
    ## 
    ## 
    ## The following objects are masked from 'package:purrr':
    ## 
    ##     %@%, flatten, flatten_chr, flatten_dbl, flatten_int, flatten_lgl,
    ##     flatten_raw, invoke, splice
    ## 
    ## 
    ## Joining with `by = join_by(Matrix)`
    ## Joining with `by = join_by(Compartment)`
    ## Joining with `by = join_by(sheet, row)`

``` r
World
```

    ## <SBcore>
    ##   Public:
    ##     CalcVar: function (aVariable) 
    ##     CleanupCalcGraphAbove: function (VarName) 
    ##     clone: function (deep = FALSE) 
    ##     doInherit: function (fromData, toData) 
    ##     fetchData: function (varname = "all") 
    ##     filterStates: function (...) 
    ##     findState: function (abbr) 
    ##     FromDataAndTo: function (processName = "all") 
    ##     initialize: function (NewstateModule) 
    ##     kaas: active binding
    ##     metaData: function () 
    ##     moduleList: active binding
    ##     NewCalcVariable: function (VariableFunction, AggrBy = NA, AggrFun = NA) 
    ##     NewFlow: function (FlowFunction, WithProcess = "k_Advection") 
    ##     NewProcess: function (ProcessFunction) 
    ##     NewSolver: function (SolverFunction, ...) 
    ##     nodelist: active binding
    ##     PostponeVarProcess: function (VarFunctions = NULL, FlowFunctions = NULL, ProcesFunctions) 
    ##     SetConst: function (...) 
    ##     SolutionAsRelational: function (...) 
    ##     Solve: function (emissions, needdebug = F, ...) 
    ##     states: active binding
    ##     UpdateData: function (UpdateDF, keys, TableName = NULL) 
    ##     UpdateDirty: function (Variables) 
    ##     UpdateKaas: function (aProcessModule = NULL, mergeExisting = T) 
    ##     VarsFromprocesses: function () 
    ##     whichDataTable: function (KeyNames) 
    ##     whichUnresolved: function () 
    ##   Private:
    ##     CalcTreeBack: function (aProcessModule) 
    ##     CalcTreeForward: function (DirtyVariables) 
    ##     CheckTree: function () 
    ##     cleanupCGAbove: function (VarName) 
    ##     DoInherit: function (fromDataName, toDataName) 
    ##     DoPostponed: function () 
    ##     FetchData: function (varname) 
    ##     FindStatefrom3D: function (df3Ds) 
    ##     ijAddState: function (ijTable) 
    ##     IntegrateKaaslist: function (kaaslist) 
    ##     l_postPoneList: NULL
    ##     ModuleList: list
    ##     nodeList: data.frame
    ##     SB4Ndata: list
    ##     SBkaas: data.frame
    ##     solver: NULL
    ##     States: SBstates, R6
    ##     storeNodes: function (aNewModule) 
    ##     substance: default substance
    ##     UpdateDL: function (VarFunName = NULL, DIMRestrict = NULL, ...) 
    ##     WhichDataTable: function (KeyNames)

## Data and variables

For calculating the rate constants for advection there is data needed
on: - Windspeed Together with the variables: -

``` r
SBvars <- c("AreaLand",
            "AreaSea",
            "Area",
            "Volume"
            )

for (x in SBvars) {
  World$NewCalcVariable(x)
  World$CalcVar(x)
}
```

## Air flow

We calculate AirFlow in two steps. The first is the application of a
simple model of air circulation depending on windspeed; The mean
residence time in the region is according the f_TAU function. r f_TAU
The AirFlow function calculates the amount that would enter/leave the
region namely the volume divided by the residence time. Notice that
f_TAU is a normal function, but AirFlow will be used as a variable
defining function. After the call to World\$CalcVar(“AirFlow”) this
property is stored in the data within World. r AirFlow. This provides
the overal airflow within a compartment which affects the flow from this
compartment or scale to the next. Currently air only flows between
scales.

``` r
World$fetchData("Volume")
```

    ##          Scale       SubCompart       Volume
    ## 1       Arctic              air 4.249999e+16
    ## 2       Arctic       cloudwater 1.275000e+10
    ## 3       Arctic        deepocean 7.650000e+16
    ## 5       Arctic      naturalsoil 8.500000e+11
    ## 6       Arctic              sea 2.550000e+15
    ## 7  Continental agriculturalsoil 4.183202e+11
    ## 8  Continental              air 7.199998e+15
    ## 9  Continental       cloudwater 2.160000e+09
    ## 11 Continental             lake 8.715005e+11
    ## 14 Continental      naturalsoil 4.706103e+10
    ## 15 Continental        othersoil 1.743001e+10
    ## 16 Continental            river 2.875952e+11
    ## 17 Continental              sea 7.427996e+14
    ## 18    Moderate              air 7.756998e+16
    ## 19    Moderate       cloudwater 2.327100e+10
    ## 20    Moderate        deepocean 1.163550e+17
    ## 22    Moderate      naturalsoil 1.939250e+12
    ## 23    Moderate              sea 3.878500e+15
    ## 24    Regional agriculturalsoil 2.747978e+10
    ## 25    Regional              air 2.299999e+14
    ## 26    Regional       cloudwater 6.900000e+07
    ## 28    Regional             lake 5.724953e+10
    ## 31    Regional      naturalsoil 3.091475e+09
    ## 32    Regional        othersoil 1.144991e+09
    ## 33    Regional            river 1.889235e+10
    ## 34    Regional              sea 1.001873e+10
    ## 35      Tropic              air 1.280000e+17
    ## 36      Tropic       cloudwater 3.840000e+10
    ## 37      Tropic        deepocean 2.688000e+17
    ## 39      Tropic      naturalsoil 1.920000e+12
    ## 40      Tropic              sea 8.960000e+15

``` r
World$fetchData("Area")
```

    ##          Scale       SubCompart         Area
    ## 1       Arctic              air 4.250000e+13
    ## 2       Arctic       cloudwater 4.250000e+13
    ## 3       Arctic        deepocean 2.550000e+13
    ## 5       Arctic      naturalsoil 1.700000e+13
    ## 6       Arctic              sea 2.550000e+13
    ## 7  Continental agriculturalsoil 2.091601e+12
    ## 8  Continental              air 7.200000e+12
    ## 9  Continental       cloudwater 7.200000e+12
    ## 11 Continental             lake 8.715005e+09
    ## 14 Continental      naturalsoil 9.412205e+11
    ## 15 Continental        othersoil 3.486002e+11
    ## 16 Continental            river 9.586505e+10
    ## 17 Continental              sea 3.713998e+12
    ## 18    Moderate              air 7.757000e+13
    ## 19    Moderate       cloudwater 7.757000e+13
    ## 20    Moderate        deepocean 3.878500e+13
    ## 22    Moderate      naturalsoil 3.878500e+13
    ## 23    Moderate              sea 3.878500e+13
    ## 24    Regional agriculturalsoil 1.373989e+11
    ## 25    Regional              air 2.300000e+11
    ## 26    Regional       cloudwater 2.300000e+11
    ## 28    Regional             lake 5.724953e+08
    ## 31    Regional      naturalsoil 6.182949e+10
    ## 32    Regional        othersoil 2.289981e+10
    ## 33    Regional            river 6.297448e+09
    ## 34    Regional              sea 1.001873e+09
    ## 35      Tropic              air 1.280000e+14
    ## 36      Tropic       cloudwater 1.280000e+14
    ## 37      Tropic        deepocean 8.960000e+13
    ## 39      Tropic      naturalsoil 3.840000e+13
    ## 40      Tropic              sea 8.960000e+13

``` r
World$fetchData("WINDspeed")
```

    ##         Scale WINDspeed
    ## 1      Arctic         3
    ## 2 Continental         3
    ## 3    Moderate         3
    ## 4    Regional         3
    ## 5      Tropic         3

``` r
World$fetchData("SubCompartName")
```

    ##            SubCompart     SubCompartName
    ## 1                 air                air
    ## 2          cloudwater         cloudwater
    ## 3  freshwatersediment freshwatersediment
    ## 4        lakesediment       lakesediment
    ## 5      marinesediment     marinesediment
    ## 6    agriculturalsoil   agriculturalsoil
    ## 7         naturalsoil        naturalsoil
    ## 8           othersoil          othersoil
    ## 9           deepocean          deepocean
    ## 10               lake               lake
    ## 11              river              river
    ## 12                sea                sea

``` r
# f_TAU
# AirFlow
World$NewCalcVariable("AirFlow")
World$CalcVar("AirFlow")
```

    ##    SubCompart       Scale     AirFlow
    ## 6         air      Arctic 29424519893
    ## 7         air      Tropic 51064596572
    ## 8         air    Regional  2164605903
    ## 9         air Continental 12111032472
    ## 10        air    Moderate 39752259252

### flow mass balance

To keep the mass balance in the model the amount from one scale to the
next would need to be equal to the amount flowing the opposite way! To
honor the mass balance we give priority to the amount calculated for the
smallest volume to calculate the actual flows. This means that for
nested scales we need to know how the nesting is. This brings a new
challange; we need to know properties of the scale the flow is going to,
or possibly the scale where it is coming from. Because of the nesting,
we need to know even properties of scale not directly related to the to-
or from- the scale! To accomodate this use of the “to.”, the “from.” and
the “all.” preposition is made available. The to- and from scaleName are
atomic (a single string) but the “all.” prepositions provides a full
table of the variable and its dimensions (in this case only accross
Scales). If you want to see what is really going on in the function
calls you can use the debug parameter. See the Debugging vignette for
further information.

``` r
x_Advection_Air
```

    ## function (all.AirFlow, from.ScaleName, to.ScaleName) 
    ## {
    ##     from.AirFlow <- all.AirFlow$AirFlow[all.AirFlow$Scale == 
    ##         from.ScaleName]
    ##     to.Airflow <- all.AirFlow$AirFlow[all.AirFlow$Scale == to.ScaleName]
    ##     Cont2Regional.Airflow <- function() {
    ##         all.AirFlow$AirFlow[all.AirFlow$Scale == "Regional"]
    ##     }
    ##     if (from.ScaleName %in% c("Arctic", "Regional", "Tropic")) {
    ##         return(all.AirFlow$AirFlow[all.AirFlow$Scale == from.ScaleName])
    ##     }
    ##     if (from.ScaleName == "Continental" & to.ScaleName == "Moderate") {
    ##         return(all.AirFlow$AirFlow[all.AirFlow$Scale == from.ScaleName] - 
    ##             Cont2Regional.Airflow())
    ##     }
    ##     if (from.ScaleName == "Moderate" & to.ScaleName == "Continental") {
    ##         return(all.AirFlow$AirFlow[all.AirFlow$Scale == to.ScaleName] - 
    ##             Cont2Regional.Airflow())
    ##     }
    ##     return(all.AirFlow$AirFlow[all.AirFlow$Scale == to.ScaleName])
    ## }

``` r
AdvAir <- World$NewFlow("x_Advection_Air")
#AdvAir$execute(debugAt = list(toScale = "Continental"))
World$CalcVar("x_Advection_Air")
```

    ## Warning in dplyr::inner_join(AllIn, private$MyCore$states$asDataFrame, join_by(fromScale == : Detected an unexpected many-to-many relationship between `x` and `y`.
    ## ℹ Row 1 of `x` matches multiple rows in `y`.
    ## ℹ Row 2 of `y` matches multiple rows in `x`.
    ## ℹ If a many-to-many relationship is expected, set `relationship =
    ##   "many-to-many"` to silence this warning.

    ## Warning in dplyr::inner_join(AllIn, private$MyCore$states$asDataFrame, join_by(toScale == : Detected an unexpected many-to-many relationship between `x` and `y`.
    ## ℹ Row 1 of `x` matches multiple rows in `y`.
    ## ℹ Row 3 of `y` matches multiple rows in `x`.
    ## ℹ If a many-to-many relationship is expected, set `relationship =
    ##   "many-to-many"` to silence this warning.

    ##     fromScale     toScale fromSubCompart        flow        FlowName
    ## 1      Arctic    Moderate            air 29424519893 x_Advection_Air
    ## 2 Continental    Moderate            air  9946426570 x_Advection_Air
    ## 3 Continental    Regional            air  2164605903 x_Advection_Air
    ## 4    Moderate      Arctic            air 29424519893 x_Advection_Air
    ## 5    Moderate Continental            air  9946426570 x_Advection_Air
    ## 6    Moderate      Tropic            air 51064596572 x_Advection_Air
    ## 7    Regional Continental            air  2164605903 x_Advection_Air
    ## 8      Tropic    Moderate            air 51064596572 x_Advection_Air
    ##   toSubCompart
    ## 1          air
    ## 2          air
    ## 3          air
    ## 4          air
    ## 5          air
    ## 6          air
    ## 7          air
    ## 8          air

This provides the air flows. To test if they add up and give the same
amount flowing to and from each scale we do the following calculation:

``` r
AirFlows <- World$fetchData("x_Advection_Air")
ToFlow <- aggregate(flow~toScale, data = AirFlows, FUN = sum)
FromFlow <- aggregate(flow~fromScale, data = AirFlows, FUN = sum)
merge(FromFlow, ToFlow, by.x = "fromScale", by.y = "toScale", suffixes = c("_from", "_to"))
```

    ##     fromScale   flow_from     flow_to
    ## 1      Arctic 29424519893 29424519893
    ## 2 Continental 12111032472 12111032472
    ## 3    Moderate 90435543035 90435543035
    ## 4    Regional  2164605903  2164605903
    ## 5      Tropic 51064596572 51064596572

## Water flow

For water the flows are relevant for different dimensions:
subcompartments and scale. This relates to water flowing from lake,
through the river compartment to the sea. And the sea flows between
scales. This is defined in the following x_flow algorithms for water
advection in the following sections. The order of calculation matters
(for regional and continental scale function x 1-5) !

### 1. x_ContRiver2Reg

x_ContRiver2Reg: based on Runoff calculates the flow from contintental
river to regional river subcompartment (not usually relevant, thus ofter
0).

``` r
x_ContRiver2Reg
```

    ## function (ScaleName, SubCompartName, all.Runoff, RainOnFreshwater, 
    ##     dischargeFRAC, LakeFracRiver) 
    ## {
    ##     switch(ScaleName, Continental = {
    ##         switch(SubCompartName, river = {
    ##             SumRainRunoff <- sum(all.Runoff$Runoff[all.Runoff$Scale == 
    ##                 "Continental"])
    ##             River2sea <- RainOnFreshwater + SumRainRunoff * (1 - 
    ##                 dischargeFRAC)
    ##             Lake2River <- LakeFracRiver * River2sea
    ##             return((RainOnFreshwater + SumRainRunoff + Lake2River) * 
    ##                 dischargeFRAC)
    ##         }, return(NA))
    ##     }, return(NA))
    ## }

``` r
World$NewCalcVariable("Runoff")
World$CalcVar("Runoff")
```

    ##          SubCompart       Scale      Runoff
    ## 3  agriculturalsoil    Regional    762.4557
    ## 5  agriculturalsoil Continental  11606.7414
    ## 41      naturalsoil      Arctic  33691.6540
    ## 42      naturalsoil Continental   5223.0336
    ## 43      naturalsoil    Moderate 215226.2494
    ## 44      naturalsoil    Regional    343.1051
    ## 45      naturalsoil      Tropic 395738.2040
    ## 46        othersoil Continental   1934.4569
    ## 49        othersoil    Regional    127.0760

``` r
World$NewCalcVariable("RainOnFreshwater")
World$CalcVar("RainOnFreshwater")
```

    ##    SubCompart       Scale RainOnFreshwater
    ## 26       lake      Arctic           0.0000
    ## 27       lake Continental           0.0000
    ## 28       lake    Moderate           0.0000
    ## 29       lake    Regional           0.0000
    ## 30       lake      Tropic           0.0000
    ## 52      river    Regional         139.7835
    ## 53      river Continental        2127.9026

``` r
World$fetchData("ScaleName")
```

    ##         Scale   ScaleName
    ## 1      Arctic      Arctic
    ## 2 Continental Continental
    ## 3    Moderate    Moderate
    ## 4    Regional    Regional
    ## 5      Tropic      Tropic

``` r
World$fetchData("SubCompartName")
```

    ##            SubCompart     SubCompartName
    ## 1                 air                air
    ## 2          cloudwater         cloudwater
    ## 3  freshwatersediment freshwatersediment
    ## 4        lakesediment       lakesediment
    ## 5      marinesediment     marinesediment
    ## 6    agriculturalsoil   agriculturalsoil
    ## 7         naturalsoil        naturalsoil
    ## 8           othersoil          othersoil
    ## 9           deepocean          deepocean
    ## 10               lake               lake
    ## 11              river              river
    ## 12                sea                sea

``` r
World$fetchData("dischargeFRAC")
```

    ##         Scale dischargeFRAC
    ## 2 Continental             0
    ## 4    Regional             0

``` r
World$fetchData("LakeFracRiver")
```

    ## [1] 0.1

``` r
World$fetchData("Runoff")
```

    ##          Scale       SubCompart      Runoff
    ## 6       Arctic      naturalsoil  33691.6540
    ## 8  Continental agriculturalsoil  11606.7414
    ## 15 Continental      naturalsoil   5223.0336
    ## 16 Continental        othersoil   1934.4569
    ## 24    Moderate      naturalsoil 215226.2494
    ## 26    Regional agriculturalsoil    762.4557
    ## 33    Regional      naturalsoil    343.1051
    ## 34    Regional        othersoil    127.0760
    ## 42      Tropic      naturalsoil 395738.2040

``` r
World$fetchData("Area")
```

    ##          Scale       SubCompart         Area
    ## 1       Arctic              air 4.250000e+13
    ## 2       Arctic       cloudwater 4.250000e+13
    ## 3       Arctic        deepocean 2.550000e+13
    ## 6       Arctic      naturalsoil 1.700000e+13
    ## 7       Arctic              sea 2.550000e+13
    ## 8  Continental agriculturalsoil 2.091601e+12
    ## 9  Continental              air 7.200000e+12
    ## 10 Continental       cloudwater 7.200000e+12
    ## 12 Continental             lake 8.715005e+09
    ## 15 Continental      naturalsoil 9.412205e+11
    ## 16 Continental        othersoil 3.486002e+11
    ## 17 Continental            river 9.586505e+10
    ## 18 Continental              sea 3.713998e+12
    ## 19    Moderate              air 7.757000e+13
    ## 20    Moderate       cloudwater 7.757000e+13
    ## 21    Moderate        deepocean 3.878500e+13
    ## 24    Moderate      naturalsoil 3.878500e+13
    ## 25    Moderate              sea 3.878500e+13
    ## 26    Regional agriculturalsoil 1.373989e+11
    ## 27    Regional              air 2.300000e+11
    ## 28    Regional       cloudwater 2.300000e+11
    ## 30    Regional             lake 5.724953e+08
    ## 33    Regional      naturalsoil 6.182949e+10
    ## 34    Regional        othersoil 2.289981e+10
    ## 35    Regional            river 6.297448e+09
    ## 36    Regional              sea 1.001873e+09
    ## 37      Tropic              air 1.280000e+14
    ## 38      Tropic       cloudwater 1.280000e+14
    ## 39      Tropic        deepocean 8.960000e+13
    ## 42      Tropic      naturalsoil 3.840000e+13
    ## 43      Tropic              sea 8.960000e+13

``` r
World$fetchData("LakeFracRiver")
```

    ## [1] 0.1

``` r
flow1 <- World$NewFlow("x_ContRiver2Reg")

flow1$FromAndTo
```

    ##     fromScale  toScale fromSubCompart
    ## 7 Continental Regional          river

``` r
flow1$execute()
```

    ## Warning in dplyr::inner_join(AllIn, private$MyCore$states$asDataFrame, join_by(toScale == : Detected an unexpected many-to-many relationship between `x` and `y`.
    ## ℹ Row 1 of `x` matches multiple rows in `y`.
    ## ℹ Row 4 of `y` matches multiple rows in `x`.
    ## ℹ If a many-to-many relationship is expected, set `relationship =
    ##   "many-to-many"` to silence this warning.

    ##     fromScale  toScale fromSubCompart flow
    ## 1 Continental Regional          river    0

``` r
World$CalcVar("x_ContRiver2Reg")
```

    ## Warning in dplyr::inner_join(AllIn, private$MyCore$states$asDataFrame, join_by(toScale == : Detected an unexpected many-to-many relationship between `x` and `y`.
    ## ℹ Row 1 of `x` matches multiple rows in `y`.
    ## ℹ Row 4 of `y` matches multiple rows in `x`.
    ## ℹ If a many-to-many relationship is expected, set `relationship =
    ##   "many-to-many"` to silence this warning.

    ##     fromScale  toScale fromSubCompart flow        FlowName toSubCompart
    ## 1 Continental Regional          river    0 x_ContRiver2Reg        river

### 2. x_RiverDischarge

``` r
World$fetchData("Runoff")
```

    ##          Scale       SubCompart      Runoff
    ## 6       Arctic      naturalsoil  33691.6540
    ## 8  Continental agriculturalsoil  11606.7414
    ## 15 Continental      naturalsoil   5223.0336
    ## 16 Continental        othersoil   1934.4569
    ## 24    Moderate      naturalsoil 215226.2494
    ## 26    Regional agriculturalsoil    762.4557
    ## 33    Regional      naturalsoil    343.1051
    ## 34    Regional        othersoil    127.0760
    ## 42      Tropic      naturalsoil 395738.2040

``` r
World$fetchData("RainOnFreshwater")
```

    ##          Scale SubCompart RainOnFreshwater
    ## 4       Arctic       lake           0.0000
    ## 12 Continental       lake           0.0000
    ## 17 Continental      river        2127.9026
    ## 22    Moderate       lake           0.0000
    ## 30    Regional       lake           0.0000
    ## 35    Regional      river         139.7835
    ## 40      Tropic       lake           0.0000

``` r
World$fetchData("dischargeFRAC")
```

    ##         Scale dischargeFRAC
    ## 2 Continental             0
    ## 4    Regional             0

``` r
World$fetchData("x_ContRiver2Reg")
```

    ##          FlowName   fromScale  toScale fromSubCompart toSubCompart flow
    ## 9 x_ContRiver2Reg Continental Regional          river        river    0

``` r
World$fetchData("ScaleName")
```

    ##         Scale   ScaleName
    ## 1      Arctic      Arctic
    ## 2 Continental Continental
    ## 3    Moderate    Moderate
    ## 4    Regional    Regional
    ## 5      Tropic      Tropic

``` r
flow2 <- World$NewFlow("x_RiverDischarge")

flow2$FromAndTo
```

    ##    fromSubCompart toSubCompart   fromScale
    ## 24          river          sea    Regional
    ## 25          river          sea Continental

``` r
flow2$execute()
```

    ## Warning in dplyr::inner_join(AllIn, private$MyCore$states$asDataFrame, join_by(toSubCompart == : Detected an unexpected many-to-many relationship between `x` and `y`.
    ## ℹ Row 1 of `x` matches multiple rows in `y`.
    ## ℹ Row 56 of `y` matches multiple rows in `x`.
    ## ℹ If a many-to-many relationship is expected, set `relationship =
    ##   "many-to-many"` to silence this warning.

    ##   fromSubCompart toSubCompart   fromScale     flow
    ## 1          river          sea    Regional  1372.42
    ## 2          river          sea Continental 20892.13

``` r
World$CalcVar("x_RiverDischarge")
```

    ## Warning in dplyr::inner_join(AllIn, private$MyCore$states$asDataFrame, join_by(toSubCompart == : Detected an unexpected many-to-many relationship between `x` and `y`.
    ## ℹ Row 1 of `x` matches multiple rows in `y`.
    ## ℹ Row 56 of `y` matches multiple rows in `x`.
    ## ℹ If a many-to-many relationship is expected, set `relationship =
    ##   "many-to-many"` to silence this warning.

    ##   fromSubCompart toSubCompart   fromScale     flow         FlowName     toScale
    ## 1          river          sea    Regional  1372.42 x_RiverDischarge    Regional
    ## 2          river          sea Continental 20892.13 x_RiverDischarge Continental

### 3. x_LakeOutflow

``` r
World$fetchData("x_RiverDischarge")
```

    ##            FlowName   fromScale     toScale fromSubCompart toSubCompart
    ## 10 x_RiverDischarge    Regional    Regional          river          sea
    ## 11 x_RiverDischarge Continental Continental          river          sea
    ##        flow
    ## 10  1372.42
    ## 11 20892.13

``` r
World$fetchData("x_ContRiver2Reg")
```

    ##          FlowName   fromScale  toScale fromSubCompart toSubCompart flow
    ## 9 x_ContRiver2Reg Continental Regional          river        river    0

``` r
World$fetchData("LakeFracRiver")
```

    ## [1] 0.1

``` r
World$fetchData("ScaleName")
```

    ##         Scale   ScaleName
    ## 1      Arctic      Arctic
    ## 2 Continental Continental
    ## 3    Moderate    Moderate
    ## 4    Regional    Regional
    ## 5      Tropic      Tropic

``` r
flow3 <- World$NewFlow("x_LakeOutflow")

flow3$FromAndTo
```

    ##    fromSubCompart toSubCompart   fromScale
    ## 12           lake        river    Regional
    ## 13           lake        river Continental

``` r
flow3$execute()
```

    ## Warning in dplyr::inner_join(AllIn, private$MyCore$states$asDataFrame, join_by(toSubCompart == : Detected an unexpected many-to-many relationship between `x` and `y`.
    ## ℹ Row 1 of `x` matches multiple rows in `y`.
    ## ℹ Row 51 of `y` matches multiple rows in `x`.
    ## ℹ If a many-to-many relationship is expected, set `relationship =
    ##   "many-to-many"` to silence this warning.

    ##   fromSubCompart toSubCompart   fromScale     flow
    ## 1           lake        river    Regional  137.242
    ## 2           lake        river Continental 2089.213

``` r
World$CalcVar("x_LakeOutflow")
```

    ## Warning in dplyr::inner_join(AllIn, private$MyCore$states$asDataFrame, join_by(toSubCompart == : Detected an unexpected many-to-many relationship between `x` and `y`.
    ## ℹ Row 1 of `x` matches multiple rows in `y`.
    ## ℹ Row 51 of `y` matches multiple rows in `x`.
    ## ℹ If a many-to-many relationship is expected, set `relationship =
    ##   "many-to-many"` to silence this warning.

    ##   fromSubCompart toSubCompart   fromScale     flow      FlowName     toScale
    ## 1           lake        river    Regional  137.242 x_LakeOutflow    Regional
    ## 2           lake        river Continental 2089.213 x_LakeOutflow Continental

### 4. x_ContSea2Reg

``` r
# these cannot be found:
World$fetchData("LakeFracRiver")
```

    ## [1] 0.1

``` r
World$fetchData("x_RiverDischarge")
```

    ##            FlowName   fromScale     toScale fromSubCompart toSubCompart
    ## 10 x_RiverDischarge    Regional    Regional          river          sea
    ## 11 x_RiverDischarge Continental Continental          river          sea
    ##        flow
    ## 10  1372.42
    ## 11 20892.13

``` r
flow4 <- World$NewFlow("x_ContSea2Reg")

flow4$FromAndTo
```

    ##     fromScale  toScale fromSubCompart
    ## 8 Continental Regional            sea

``` r
flow4$execute()
```

    ## Warning in dplyr::inner_join(AllIn, private$MyCore$states$asDataFrame, join_by(toScale == : Detected an unexpected many-to-many relationship between `x` and `y`.
    ## ℹ Row 1 of `x` matches multiple rows in `y`.
    ## ℹ Row 4 of `y` matches multiple rows in `x`.
    ## ℹ If a many-to-many relationship is expected, set `relationship =
    ##   "many-to-many"` to silence this warning.

    ##     fromScale  toScale fromSubCompart     flow
    ## 1 Continental Regional            sea 12351.78

``` r
World$CalcVar("x_ContSea2Reg")
```

    ## Warning in dplyr::inner_join(AllIn, private$MyCore$states$asDataFrame, join_by(toScale == : Detected an unexpected many-to-many relationship between `x` and `y`.
    ## ℹ Row 1 of `x` matches multiple rows in `y`.
    ## ℹ Row 4 of `y` matches multiple rows in `x`.
    ## ℹ If a many-to-many relationship is expected, set `relationship =
    ##   "many-to-many"` to silence this warning.

    ##     fromScale  toScale fromSubCompart     flow      FlowName toSubCompart
    ## 1 Continental Regional            sea 12351.78 x_ContSea2Reg          sea

### 5. x_RegSea2Cont

``` r
World$fetchData("LakeFracRiver")
```

    ## [1] 0.1

``` r
World$fetchData("x_RiverDischarge")
```

    ##            FlowName   fromScale     toScale fromSubCompart toSubCompart
    ## 10 x_RiverDischarge    Regional    Regional          river          sea
    ## 11 x_RiverDischarge Continental Continental          river          sea
    ##        flow
    ## 10  1372.42
    ## 11 20892.13

``` r
flow5 <- World$NewFlow("x_RegSea2Cont")

flow5$FromAndTo
```

    ##    fromScale     toScale fromSubCompart
    ## 23  Regional Continental            sea

``` r
flow5$execute()
```

    ## Warning in dplyr::inner_join(AllIn, private$MyCore$states$asDataFrame, join_by(toScale == : Detected an unexpected many-to-many relationship between `x` and `y`.
    ## ℹ Row 1 of `x` matches multiple rows in `y`.
    ## ℹ Row 2 of `y` matches multiple rows in `x`.
    ## ℹ If a many-to-many relationship is expected, set `relationship =
    ##   "many-to-many"` to silence this warning.

    ##   fromScale     toScale fromSubCompart    flow
    ## 1  Regional Continental            sea 13724.2

``` r
World$CalcVar("x_RegSea2Cont")
```

    ## Warning in dplyr::inner_join(AllIn, private$MyCore$states$asDataFrame, join_by(toScale == : Detected an unexpected many-to-many relationship between `x` and `y`.
    ## ℹ Row 1 of `x` matches multiple rows in `y`.
    ## ℹ Row 2 of `y` matches multiple rows in `x`.
    ## ℹ If a many-to-many relationship is expected, set `relationship =
    ##   "many-to-many"` to silence this warning.

    ##   fromScale     toScale fromSubCompart    flow      FlowName toSubCompart
    ## 1  Regional Continental            sea 13724.2 x_RegSea2Cont          sea

### 6. x_ToModerateWater

Advection of continental sea, Tropic and Arctic sea compartments to sea
and deepocean at Moderate scale

``` r
World$fetchData("Volume")
```

    ##          Scale       SubCompart       Volume
    ## 1       Arctic              air 4.249999e+16
    ## 2       Arctic       cloudwater 1.275000e+10
    ## 3       Arctic        deepocean 7.650000e+16
    ## 6       Arctic      naturalsoil 8.500000e+11
    ## 7       Arctic              sea 2.550000e+15
    ## 8  Continental agriculturalsoil 4.183202e+11
    ## 9  Continental              air 7.199998e+15
    ## 10 Continental       cloudwater 2.160000e+09
    ## 12 Continental             lake 8.715005e+11
    ## 15 Continental      naturalsoil 4.706103e+10
    ## 16 Continental        othersoil 1.743001e+10
    ## 17 Continental            river 2.875952e+11
    ## 18 Continental              sea 7.427996e+14
    ## 19    Moderate              air 7.756998e+16
    ## 20    Moderate       cloudwater 2.327100e+10
    ## 21    Moderate        deepocean 1.163550e+17
    ## 24    Moderate      naturalsoil 1.939250e+12
    ## 25    Moderate              sea 3.878500e+15
    ## 26    Regional agriculturalsoil 2.747978e+10
    ## 27    Regional              air 2.299999e+14
    ## 28    Regional       cloudwater 6.900000e+07
    ## 30    Regional             lake 5.724953e+10
    ## 33    Regional      naturalsoil 3.091475e+09
    ## 34    Regional        othersoil 1.144991e+09
    ## 35    Regional            river 1.889235e+10
    ## 36    Regional              sea 1.001873e+10
    ## 37      Tropic              air 1.280000e+17
    ## 38      Tropic       cloudwater 3.840000e+10
    ## 39      Tropic        deepocean 2.688000e+17
    ## 42      Tropic      naturalsoil 1.920000e+12
    ## 43      Tropic              sea 8.960000e+15

``` r
World$fetchData("TAUsea")
```

    ##         Scale   TAUsea
    ## 1      Arctic  4752000
    ## 2 Continental 31536000
    ## 3    Moderate  4752000
    ## 5      Tropic  4752000

``` r
World$fetchData("x_RegSea2Cont")
```

    ##         FlowName fromScale     toScale fromSubCompart toSubCompart    flow
    ## 15 x_RegSea2Cont  Regional Continental            sea          sea 13724.2

``` r
flow6 <- World$NewFlow("x_ToModerateWater")

flow6$FromAndTo
```

    ##      fromScale  toScale fromSubCompart
    ## 2       Arctic Moderate            sea
    ## 3       Arctic Moderate      deepocean
    ## 5  Continental Moderate            sea
    ## 30      Tropic Moderate            sea
    ## 31      Tropic Moderate      deepocean

``` r
flow6$execute()
```

    ## Warning in dplyr::inner_join(AllIn, private$MyCore$states$asDataFrame, join_by(toScale == : Detected an unexpected many-to-many relationship between `x` and `y`.
    ## ℹ Row 1 of `x` matches multiple rows in `y`.
    ## ℹ Row 3 of `y` matches multiple rows in `x`.
    ## ℹ If a many-to-many relationship is expected, set `relationship =
    ##   "many-to-many"` to silence this warning.

    ##     fromScale  toScale fromSubCompart      flow
    ## 1      Arctic Moderate            sea         0
    ## 2      Arctic Moderate      deepocean 150000000
    ## 3 Continental Moderate            sea  23540297
    ## 4      Tropic Moderate            sea 150000000
    ## 5      Tropic Moderate      deepocean         0

``` r
World$CalcVar("x_ToModerateWater")
```

    ## Warning in dplyr::inner_join(AllIn, private$MyCore$states$asDataFrame, join_by(toScale == : Detected an unexpected many-to-many relationship between `x` and `y`.
    ## ℹ Row 1 of `x` matches multiple rows in `y`.
    ## ℹ Row 3 of `y` matches multiple rows in `x`.
    ## ℹ If a many-to-many relationship is expected, set `relationship =
    ##   "many-to-many"` to silence this warning.

    ##     fromScale  toScale fromSubCompart      flow          FlowName toSubCompart
    ## 1      Arctic Moderate            sea         0 x_ToModerateWater          sea
    ## 2      Arctic Moderate      deepocean 150000000 x_ToModerateWater    deepocean
    ## 3 Continental Moderate            sea  23540297 x_ToModerateWater          sea
    ## 4      Tropic Moderate            sea 150000000 x_ToModerateWater          sea
    ## 5      Tropic Moderate      deepocean         0 x_ToModerateWater    deepocean

### Water flow from Moderate Scale

#### 7. x_FromModerate2TropWater

Seperated in different flows based on the to Scale

``` r
World$fetchData("Volume")
```

    ##          Scale       SubCompart       Volume
    ## 1       Arctic              air 4.249999e+16
    ## 2       Arctic       cloudwater 1.275000e+10
    ## 3       Arctic        deepocean 7.650000e+16
    ## 6       Arctic      naturalsoil 8.500000e+11
    ## 7       Arctic              sea 2.550000e+15
    ## 8  Continental agriculturalsoil 4.183202e+11
    ## 9  Continental              air 7.199998e+15
    ## 10 Continental       cloudwater 2.160000e+09
    ## 12 Continental             lake 8.715005e+11
    ## 15 Continental      naturalsoil 4.706103e+10
    ## 16 Continental        othersoil 1.743001e+10
    ## 17 Continental            river 2.875952e+11
    ## 18 Continental              sea 7.427996e+14
    ## 19    Moderate              air 7.756998e+16
    ## 20    Moderate       cloudwater 2.327100e+10
    ## 21    Moderate        deepocean 1.163550e+17
    ## 24    Moderate      naturalsoil 1.939250e+12
    ## 25    Moderate              sea 3.878500e+15
    ## 26    Regional agriculturalsoil 2.747978e+10
    ## 27    Regional              air 2.299999e+14
    ## 28    Regional       cloudwater 6.900000e+07
    ## 30    Regional             lake 5.724953e+10
    ## 33    Regional      naturalsoil 3.091475e+09
    ## 34    Regional        othersoil 1.144991e+09
    ## 35    Regional            river 1.889235e+10
    ## 36    Regional              sea 1.001873e+10
    ## 37      Tropic              air 1.280000e+17
    ## 38      Tropic       cloudwater 3.840000e+10
    ## 39      Tropic        deepocean 2.688000e+17
    ## 42      Tropic      naturalsoil 1.920000e+12
    ## 43      Tropic              sea 8.960000e+15

``` r
World$fetchData("TAUsea")
```

    ##         Scale   TAUsea
    ## 1      Arctic  4752000
    ## 2 Continental 31536000
    ## 3    Moderate  4752000
    ## 5      Tropic  4752000

``` r
World$fetchData("OceanCurrent")
```

    ## [1] 1.5e+08

``` r
World$fetchData("x_RegSea2Cont")
```

    ##         FlowName fromScale     toScale fromSubCompart toSubCompart    flow
    ## 15 x_RegSea2Cont  Regional Continental            sea          sea 13724.2

``` r
World$fetchData("ScaleName")
```

    ##         Scale   ScaleName
    ## 1      Arctic      Arctic
    ## 2 Continental Continental
    ## 3    Moderate    Moderate
    ## 4    Regional    Regional
    ## 5      Tropic      Tropic

``` r
flow <- World$NewFlow("x_FromModerate2TropWater")
# flow$execute(debugAt = list())
flow$FromAndTo
```

    ##    fromScale toScale fromSubCompart
    ## 20  Moderate  Tropic            sea
    ## 21  Moderate  Tropic      deepocean

``` r
flow$execute()
```

    ## Warning in dplyr::inner_join(AllIn, private$MyCore$states$asDataFrame, join_by(toScale == : Detected an unexpected many-to-many relationship between `x` and `y`.
    ## ℹ Row 1 of `x` matches multiple rows in `y`.
    ## ℹ Row 5 of `y` matches multiple rows in `x`.
    ## ℹ If a many-to-many relationship is expected, set `relationship =
    ##   "many-to-many"` to silence this warning.

    ##   fromScale toScale fromSubCompart    flow
    ## 1  Moderate  Tropic            sea 0.0e+00
    ## 2  Moderate  Tropic      deepocean 1.5e+08

``` r
World$CalcVar("x_FromModerate2TropWater")
```

    ## Warning in dplyr::inner_join(AllIn, private$MyCore$states$asDataFrame, join_by(toScale == : Detected an unexpected many-to-many relationship between `x` and `y`.
    ## ℹ Row 1 of `x` matches multiple rows in `y`.
    ## ℹ Row 5 of `y` matches multiple rows in `x`.
    ## ℹ If a many-to-many relationship is expected, set `relationship =
    ##   "many-to-many"` to silence this warning.

    ##   fromScale toScale fromSubCompart    flow                 FlowName
    ## 1  Moderate  Tropic            sea 0.0e+00 x_FromModerate2TropWater
    ## 2  Moderate  Tropic      deepocean 1.5e+08 x_FromModerate2TropWater
    ##   toSubCompart
    ## 1          sea
    ## 2    deepocean

#### 8. x_FromModerate2ArctWater

``` r
World$fetchData("OceanCurrent")
```

    ## [1] 1.5e+08

``` r
World$fetchData("ScaleName")
```

    ##         Scale   ScaleName
    ## 1      Arctic      Arctic
    ## 2 Continental Continental
    ## 3    Moderate    Moderate
    ## 4    Regional    Regional
    ## 5      Tropic      Tropic

``` r
flow <- World$NewFlow("x_FromModerate2ArctWater")
# flow$execute(debugAt = list())
flow$FromAndTo
```

    ##    fromScale toScale fromSubCompart
    ## 15  Moderate  Arctic            sea
    ## 16  Moderate  Arctic      deepocean

``` r
flow$execute()
```

    ## Warning in dplyr::inner_join(AllIn, private$MyCore$states$asDataFrame, join_by(toScale == : Detected an unexpected many-to-many relationship between `x` and `y`.
    ## ℹ Row 1 of `x` matches multiple rows in `y`.
    ## ℹ Row 1 of `y` matches multiple rows in `x`.
    ## ℹ If a many-to-many relationship is expected, set `relationship =
    ##   "many-to-many"` to silence this warning.

    ##   fromScale toScale fromSubCompart    flow
    ## 1  Moderate  Arctic            sea 1.5e+08
    ## 2  Moderate  Arctic      deepocean 0.0e+00

``` r
World$CalcVar("x_FromModerate2ArctWater")
```

    ## Warning in dplyr::inner_join(AllIn, private$MyCore$states$asDataFrame, join_by(toScale == : Detected an unexpected many-to-many relationship between `x` and `y`.
    ## ℹ Row 1 of `x` matches multiple rows in `y`.
    ## ℹ Row 1 of `y` matches multiple rows in `x`.
    ## ℹ If a many-to-many relationship is expected, set `relationship =
    ##   "many-to-many"` to silence this warning.

    ##   fromScale toScale fromSubCompart    flow                 FlowName
    ## 1  Moderate  Arctic            sea 1.5e+08 x_FromModerate2ArctWater
    ## 2  Moderate  Arctic      deepocean 0.0e+00 x_FromModerate2ArctWater
    ##   toSubCompart
    ## 1          sea
    ## 2    deepocean

#### 9. x_FromModerate2ContWater

``` r
# required data:
World$fetchData("Volume")
```

    ##          Scale       SubCompart       Volume
    ## 1       Arctic              air 4.249999e+16
    ## 2       Arctic       cloudwater 1.275000e+10
    ## 3       Arctic        deepocean 7.650000e+16
    ## 6       Arctic      naturalsoil 8.500000e+11
    ## 7       Arctic              sea 2.550000e+15
    ## 8  Continental agriculturalsoil 4.183202e+11
    ## 9  Continental              air 7.199998e+15
    ## 10 Continental       cloudwater 2.160000e+09
    ## 12 Continental             lake 8.715005e+11
    ## 15 Continental      naturalsoil 4.706103e+10
    ## 16 Continental        othersoil 1.743001e+10
    ## 17 Continental            river 2.875952e+11
    ## 18 Continental              sea 7.427996e+14
    ## 19    Moderate              air 7.756998e+16
    ## 20    Moderate       cloudwater 2.327100e+10
    ## 21    Moderate        deepocean 1.163550e+17
    ## 24    Moderate      naturalsoil 1.939250e+12
    ## 25    Moderate              sea 3.878500e+15
    ## 26    Regional agriculturalsoil 2.747978e+10
    ## 27    Regional              air 2.299999e+14
    ## 28    Regional       cloudwater 6.900000e+07
    ## 30    Regional             lake 5.724953e+10
    ## 33    Regional      naturalsoil 3.091475e+09
    ## 34    Regional        othersoil 1.144991e+09
    ## 35    Regional            river 1.889235e+10
    ## 36    Regional              sea 1.001873e+10
    ## 37      Tropic              air 1.280000e+17
    ## 38      Tropic       cloudwater 3.840000e+10
    ## 39      Tropic        deepocean 2.688000e+17
    ## 42      Tropic      naturalsoil 1.920000e+12
    ## 43      Tropic              sea 8.960000e+15

``` r
World$fetchData("TAUsea")
```

    ##         Scale   TAUsea
    ## 1      Arctic  4752000
    ## 2 Continental 31536000
    ## 3    Moderate  4752000
    ## 5      Tropic  4752000

``` r
World$fetchData("OceanCurrent")
```

    ## [1] 1.5e+08

``` r
World$fetchData("x_RegSea2Cont")
```

    ##         FlowName fromScale     toScale fromSubCompart toSubCompart    flow
    ## 15 x_RegSea2Cont  Regional Continental            sea          sea 13724.2

``` r
World$fetchData("ScaleName")
```

    ##         Scale   ScaleName
    ## 1      Arctic      Arctic
    ## 2 Continental Continental
    ## 3    Moderate    Moderate
    ## 4    Regional    Regional
    ## 5      Tropic      Tropic

``` r
flow <- World$NewFlow("x_FromModerate2ContWater")
# flow$execute(debugAt = list())
flow$FromAndTo
```

    ##    fromScale     toScale fromSubCompart
    ## 18  Moderate Continental            sea

``` r
flow$execute()
```

    ## Warning in dplyr::inner_join(AllIn, private$MyCore$states$asDataFrame, join_by(toScale == : Detected an unexpected many-to-many relationship between `x` and `y`.
    ## ℹ Row 1 of `x` matches multiple rows in `y`.
    ## ℹ Row 2 of `y` matches multiple rows in `x`.
    ## ℹ If a many-to-many relationship is expected, set `relationship =
    ##   "many-to-many"` to silence this warning.

    ##   fromScale     toScale fromSubCompart     flow
    ## 1  Moderate Continental            sea 23540297

``` r
World$CalcVar("x_FromModerate2ContWater")
```

    ## Warning in dplyr::inner_join(AllIn, private$MyCore$states$asDataFrame, join_by(toScale == : Detected an unexpected many-to-many relationship between `x` and `y`.
    ## ℹ Row 1 of `x` matches multiple rows in `y`.
    ## ℹ Row 2 of `y` matches multiple rows in `x`.
    ## ℹ If a many-to-many relationship is expected, set `relationship =
    ##   "many-to-many"` to silence this warning.

    ##   fromScale     toScale fromSubCompart     flow                 FlowName
    ## 1  Moderate Continental            sea 23540297 x_FromModerate2ContWater
    ##   toSubCompart
    ## 1          sea

### 10. x_OceanMixing2Deep

``` r
x_OceanMixing2Deep
```

    ## function (Volume, TAUsea, OceanCurrent, ScaleName, SubCompartName) 
    ## {
    ##     switch(SubCompartName, sea = {
    ##         OceanMixingFlow <- Volume/TAUsea
    ##         if (ScaleName %in% c("Moderate", "Arctic", "Tropic")) {
    ##             return((OceanMixingFlow + OceanCurrent))
    ##         } else {
    ##             return(NA)
    ##         }
    ##     }, return(NA))
    ## }

``` r
World$fetchData("Volume")
```

    ##          Scale       SubCompart       Volume
    ## 1       Arctic              air 4.249999e+16
    ## 2       Arctic       cloudwater 1.275000e+10
    ## 3       Arctic        deepocean 7.650000e+16
    ## 6       Arctic      naturalsoil 8.500000e+11
    ## 7       Arctic              sea 2.550000e+15
    ## 8  Continental agriculturalsoil 4.183202e+11
    ## 9  Continental              air 7.199998e+15
    ## 10 Continental       cloudwater 2.160000e+09
    ## 12 Continental             lake 8.715005e+11
    ## 15 Continental      naturalsoil 4.706103e+10
    ## 16 Continental        othersoil 1.743001e+10
    ## 17 Continental            river 2.875952e+11
    ## 18 Continental              sea 7.427996e+14
    ## 19    Moderate              air 7.756998e+16
    ## 20    Moderate       cloudwater 2.327100e+10
    ## 21    Moderate        deepocean 1.163550e+17
    ## 24    Moderate      naturalsoil 1.939250e+12
    ## 25    Moderate              sea 3.878500e+15
    ## 26    Regional agriculturalsoil 2.747978e+10
    ## 27    Regional              air 2.299999e+14
    ## 28    Regional       cloudwater 6.900000e+07
    ## 30    Regional             lake 5.724953e+10
    ## 33    Regional      naturalsoil 3.091475e+09
    ## 34    Regional        othersoil 1.144991e+09
    ## 35    Regional            river 1.889235e+10
    ## 36    Regional              sea 1.001873e+10
    ## 37      Tropic              air 1.280000e+17
    ## 38      Tropic       cloudwater 3.840000e+10
    ## 39      Tropic        deepocean 2.688000e+17
    ## 42      Tropic      naturalsoil 1.920000e+12
    ## 43      Tropic              sea 8.960000e+15

``` r
World$fetchData("TAUsea")
```

    ##         Scale   TAUsea
    ## 1      Arctic  4752000
    ## 2 Continental 31536000
    ## 3    Moderate  4752000
    ## 5      Tropic  4752000

``` r
World$fetchData("OceanCurrent")
```

    ## [1] 1.5e+08

``` r
World$fetchData("SubCompartName")
```

    ##            SubCompart     SubCompartName
    ## 1                 air                air
    ## 2          cloudwater         cloudwater
    ## 3  freshwatersediment freshwatersediment
    ## 4        lakesediment       lakesediment
    ## 5      marinesediment     marinesediment
    ## 6    agriculturalsoil   agriculturalsoil
    ## 7         naturalsoil        naturalsoil
    ## 8           othersoil          othersoil
    ## 9           deepocean          deepocean
    ## 10               lake               lake
    ## 11              river              river
    ## 12                sea                sea

``` r
flow <- World$NewFlow("x_OceanMixing2Deep")

flow$FromAndTo
```

    ##    fromSubCompart toSubCompart fromScale
    ## 26            sea    deepocean  Moderate
    ## 27            sea    deepocean    Tropic
    ## 28            sea    deepocean    Arctic

``` r
flow$execute()
```

    ## Warning in dplyr::inner_join(AllIn, private$MyCore$states$asDataFrame, join_by(toSubCompart == : Detected an unexpected many-to-many relationship between `x` and `y`.
    ## ℹ Row 1 of `x` matches multiple rows in `y`.
    ## ℹ Row 41 of `y` matches multiple rows in `x`.
    ## ℹ If a many-to-many relationship is expected, set `relationship =
    ##   "many-to-many"` to silence this warning.

    ##   fromSubCompart toSubCompart fromScale       flow
    ## 1            sea    deepocean  Moderate  966182660
    ## 2            sea    deepocean    Tropic 2035521886
    ## 3            sea    deepocean    Arctic  686616162

``` r
World$CalcVar("x_OceanMixing2Deep")
```

    ## Warning in dplyr::inner_join(AllIn, private$MyCore$states$asDataFrame, join_by(toSubCompart == : Detected an unexpected many-to-many relationship between `x` and `y`.
    ## ℹ Row 1 of `x` matches multiple rows in `y`.
    ## ℹ Row 41 of `y` matches multiple rows in `x`.
    ## ℹ If a many-to-many relationship is expected, set `relationship =
    ##   "many-to-many"` to silence this warning.

    ##   fromSubCompart toSubCompart fromScale       flow           FlowName  toScale
    ## 1            sea    deepocean  Moderate  966182660 x_OceanMixing2Deep Moderate
    ## 2            sea    deepocean    Tropic 2035521886 x_OceanMixing2Deep   Tropic
    ## 3            sea    deepocean    Arctic  686616162 x_OceanMixing2Deep   Arctic

### 11. x_OceanMixing2Sea

``` r
x_OceanMixing2Sea
```

    ## function (all.Volume, TAUsea, OceanCurrent, SubCompartName, ScaleName) 
    ## {
    ##     switch(SubCompartName, deepocean = {
    ##         toVolume <- all.Volume$Volume[all.Volume$SubCompart == 
    ##             "sea" & all.Volume$Scale == ScaleName]
    ##         OceanMixingFlow <- toVolume/TAUsea
    ##         if (ScaleName %in% c("Moderate", "Tropic", "Arctic")) {
    ##             return((OceanMixingFlow + OceanCurrent))
    ##         } else return(NA)
    ##     }, return(NA))
    ## }

``` r
World$fetchData("Volume")
```

    ##          Scale       SubCompart       Volume
    ## 1       Arctic              air 4.249999e+16
    ## 2       Arctic       cloudwater 1.275000e+10
    ## 3       Arctic        deepocean 7.650000e+16
    ## 6       Arctic      naturalsoil 8.500000e+11
    ## 7       Arctic              sea 2.550000e+15
    ## 8  Continental agriculturalsoil 4.183202e+11
    ## 9  Continental              air 7.199998e+15
    ## 10 Continental       cloudwater 2.160000e+09
    ## 12 Continental             lake 8.715005e+11
    ## 15 Continental      naturalsoil 4.706103e+10
    ## 16 Continental        othersoil 1.743001e+10
    ## 17 Continental            river 2.875952e+11
    ## 18 Continental              sea 7.427996e+14
    ## 19    Moderate              air 7.756998e+16
    ## 20    Moderate       cloudwater 2.327100e+10
    ## 21    Moderate        deepocean 1.163550e+17
    ## 24    Moderate      naturalsoil 1.939250e+12
    ## 25    Moderate              sea 3.878500e+15
    ## 26    Regional agriculturalsoil 2.747978e+10
    ## 27    Regional              air 2.299999e+14
    ## 28    Regional       cloudwater 6.900000e+07
    ## 30    Regional             lake 5.724953e+10
    ## 33    Regional      naturalsoil 3.091475e+09
    ## 34    Regional        othersoil 1.144991e+09
    ## 35    Regional            river 1.889235e+10
    ## 36    Regional              sea 1.001873e+10
    ## 37      Tropic              air 1.280000e+17
    ## 38      Tropic       cloudwater 3.840000e+10
    ## 39      Tropic        deepocean 2.688000e+17
    ## 42      Tropic      naturalsoil 1.920000e+12
    ## 43      Tropic              sea 8.960000e+15

``` r
World$fetchData("TAUsea")
```

    ##         Scale   TAUsea
    ## 1      Arctic  4752000
    ## 2 Continental 31536000
    ## 3    Moderate  4752000
    ## 5      Tropic  4752000

``` r
World$fetchData("OceanCurrent")
```

    ## [1] 1.5e+08

``` r
World$fetchData("SubCompartName")
```

    ##            SubCompart     SubCompartName
    ## 1                 air                air
    ## 2          cloudwater         cloudwater
    ## 3  freshwatersediment freshwatersediment
    ## 4        lakesediment       lakesediment
    ## 5      marinesediment     marinesediment
    ## 6    agriculturalsoil   agriculturalsoil
    ## 7         naturalsoil        naturalsoil
    ## 8           othersoil          othersoil
    ## 9           deepocean          deepocean
    ## 10               lake               lake
    ## 11              river              river
    ## 12                sea                sea

``` r
flow <- World$NewFlow("x_OceanMixing2Sea")

flow$FromAndTo
```

    ##    fromSubCompart toSubCompart fromScale
    ## 9       deepocean          sea  Moderate
    ## 10      deepocean          sea    Tropic
    ## 11      deepocean          sea    Arctic

``` r
flow$execute()
```

    ## Warning in dplyr::inner_join(AllIn, private$MyCore$states$asDataFrame, join_by(toSubCompart == : Detected an unexpected many-to-many relationship between `x` and `y`.
    ## ℹ Row 1 of `x` matches multiple rows in `y`.
    ## ℹ Row 56 of `y` matches multiple rows in `x`.
    ## ℹ If a many-to-many relationship is expected, set `relationship =
    ##   "many-to-many"` to silence this warning.

    ##   fromSubCompart toSubCompart fromScale       flow
    ## 1      deepocean          sea  Moderate  966182660
    ## 2      deepocean          sea    Tropic 2035521886
    ## 3      deepocean          sea    Arctic  686616162

``` r
World$CalcVar("x_OceanMixing2Sea")
```

    ## Warning in dplyr::inner_join(AllIn, private$MyCore$states$asDataFrame, join_by(toSubCompart == : Detected an unexpected many-to-many relationship between `x` and `y`.
    ## ℹ Row 1 of `x` matches multiple rows in `y`.
    ## ℹ Row 56 of `y` matches multiple rows in `x`.
    ## ℹ If a many-to-many relationship is expected, set `relationship =
    ##   "many-to-many"` to silence this warning.

    ##   fromSubCompart toSubCompart fromScale       flow          FlowName  toScale
    ## 1      deepocean          sea  Moderate  966182660 x_OceanMixing2Sea Moderate
    ## 2      deepocean          sea    Tropic 2035521886 x_OceanMixing2Sea   Tropic
    ## 3      deepocean          sea    Arctic  686616162 x_OceanMixing2Sea   Arctic

### Overview of water flows

Overview of flows included above (excludes surface - deep ocean mixing
and ocean currents at global scales)

``` r
flows = World$moduleList[["k_Advection"]]$WithFlow

flux2Test <- World$fetchData("Flows")
flux2Test <- flux2Test[flux2Test$FlowName %in% flows & flux2Test$fromSubCompart %in% c("river","sea","lake","deepocean"),]
flux2Test$fromScale <- factor(flux2Test$fromScale, levels = c("Regional", "Continental", "Moderate","Arctic","Tropic")) #force order
flux2Test$toScale <- factor(flux2Test$toScale, levels = c("Regional", "Continental", "Moderate","Arctic","Tropic")) #force order
flux2Test$fromSubCompart <- factor(flux2Test$fromSubCompart, levels = c("lake", "river", "sea","deepocean")) #force order
flux2Test$toSubCompart <- factor(flux2Test$toSubCompart, levels = c("lake", "river", "sea","deepocean")) #force order
f2Torder <- order(flux2Test$fromScale, flux2Test$fromSubCompart, flux2Test$toScale, flux2Test$toSubCompart)

flux2Test$fcolumns <- do.call(paste, c(flux2Test[c("fromScale", "fromSubCompart")], sep="."))
flux2Test$frows <- do.call(paste, c(flux2Test[c("toScale", "toSubCompart")], sep = "."))
#flux2Test$flux = 10e9 * flux2Test$flux # tune unit 

pivot_wider(flux2Test[f2Torder,c("frows","fcolumns","flow")],
            id_cols = frows, names_from = fcolumns, values_from = flow)
```

    ## # A tibble: 10 × 13
    ##    frows              Regional.lake Regional.river Regional.sea Continental.lake
    ##    <chr>                      <dbl>          <dbl>        <dbl>            <dbl>
    ##  1 Regional.river              137.            NA           NA               NA 
    ##  2 Regional.sea                 NA           1372.          NA               NA 
    ##  3 Continental.sea              NA             NA        13724.              NA 
    ##  4 Continental.river            NA             NA           NA             2089.
    ##  5 Moderate.sea                 NA             NA           NA               NA 
    ##  6 Moderate.deepocean           NA             NA           NA               NA 
    ##  7 Arctic.sea                   NA             NA           NA               NA 
    ##  8 Tropic.sea                   NA             NA           NA               NA 
    ##  9 Arctic.deepocean             NA             NA           NA               NA 
    ## 10 Tropic.deepocean             NA             NA           NA               NA 
    ## # ℹ 8 more variables: Continental.river <dbl>, Continental.sea <dbl>,
    ## #   Moderate.sea <dbl>, Moderate.deepocean <dbl>, Arctic.sea <dbl>,
    ## #   Arctic.deepocean <dbl>, Tropic.sea <dbl>, Tropic.deepocean <dbl>

## Advection rate constant

This process is only one step beyond the calculation of the relevant
flows, see the function f_Advection. All flows are by default associated
with this process. “flow” is used as special keyword, there is no SB
variable with the name flow. You can find the values by fetching
“Flows”. This also means the script to get the k_Advection is a little
different from other k’s. See below:

``` r
World$fetchData("Flows")
```

    ##                    FlowName   fromScale     toScale fromSubCompart toSubCompart
    ## 1           x_Advection_Air      Arctic    Moderate            air          air
    ## 2           x_Advection_Air Continental    Moderate            air          air
    ## 3           x_Advection_Air Continental    Regional            air          air
    ## 4           x_Advection_Air    Moderate      Arctic            air          air
    ## 5           x_Advection_Air    Moderate Continental            air          air
    ## 6           x_Advection_Air    Moderate      Tropic            air          air
    ## 7           x_Advection_Air    Regional Continental            air          air
    ## 8           x_Advection_Air      Tropic    Moderate            air          air
    ## 9           x_ContRiver2Reg Continental    Regional          river        river
    ## 10         x_RiverDischarge    Regional    Regional          river          sea
    ## 11         x_RiverDischarge Continental Continental          river          sea
    ## 12            x_LakeOutflow    Regional    Regional           lake        river
    ## 13            x_LakeOutflow Continental Continental           lake        river
    ## 14            x_ContSea2Reg Continental    Regional            sea          sea
    ## 15            x_RegSea2Cont    Regional Continental            sea          sea
    ## 16        x_ToModerateWater      Arctic    Moderate            sea          sea
    ## 17        x_ToModerateWater      Arctic    Moderate      deepocean    deepocean
    ## 18        x_ToModerateWater Continental    Moderate            sea          sea
    ## 19        x_ToModerateWater      Tropic    Moderate            sea          sea
    ## 20        x_ToModerateWater      Tropic    Moderate      deepocean    deepocean
    ## 21 x_FromModerate2TropWater    Moderate      Tropic            sea          sea
    ## 22 x_FromModerate2TropWater    Moderate      Tropic      deepocean    deepocean
    ## 23 x_FromModerate2ArctWater    Moderate      Arctic            sea          sea
    ## 24 x_FromModerate2ArctWater    Moderate      Arctic      deepocean    deepocean
    ## 25 x_FromModerate2ContWater    Moderate Continental            sea          sea
    ## 26       x_OceanMixing2Deep    Moderate    Moderate            sea    deepocean
    ## 27       x_OceanMixing2Deep      Tropic      Tropic            sea    deepocean
    ## 28       x_OceanMixing2Deep      Arctic      Arctic            sea    deepocean
    ## 29        x_OceanMixing2Sea    Moderate    Moderate      deepocean          sea
    ## 30        x_OceanMixing2Sea      Tropic      Tropic      deepocean          sea
    ## 31        x_OceanMixing2Sea      Arctic      Arctic      deepocean          sea
    ##            flow
    ## 1  2.942452e+10
    ## 2  9.946427e+09
    ## 3  2.164606e+09
    ## 4  2.942452e+10
    ## 5  9.946427e+09
    ## 6  5.106460e+10
    ## 7  2.164606e+09
    ## 8  5.106460e+10
    ## 9  0.000000e+00
    ## 10 1.372420e+03
    ## 11 2.089213e+04
    ## 12 1.372420e+02
    ## 13 2.089213e+03
    ## 14 1.235178e+04
    ## 15 1.372420e+04
    ## 16 0.000000e+00
    ## 17 1.500000e+08
    ## 18 2.354030e+07
    ## 19 1.500000e+08
    ## 20 0.000000e+00
    ## 21 0.000000e+00
    ## 22 1.500000e+08
    ## 23 1.500000e+08
    ## 24 0.000000e+00
    ## 25 2.354030e+07
    ## 26 9.661827e+08
    ## 27 2.035522e+09
    ## 28 6.866162e+08
    ## 29 9.661827e+08
    ## 30 2.035522e+09
    ## 31 6.866162e+08

``` r
# Don't create a new process like: World$FromDataAndTo("k_Advection")
# find the existing one like this:
testProc <- World$moduleList[["k_Advection"]]
# FromDataAndTo is from and to from the data, ultimately the property is used
# which can derived from the flows for Advection
FAT <- testProc$FromAndTo
# the data frmae to be calculated:
left_join(rename(FAT, "Scale" = "fromScale", "SubCompart" = "fromSubCompart"), World$fetchData("Volume"))
```

    ## Joining with `by = join_by(Scale, SubCompart)`

    ##           Scale     toScale SubCompart toSubCompart     process fromSpecies
    ## 1        Arctic    Moderate        air          air k_Advection       Large
    ## 2   Continental    Moderate        air          air k_Advection       Large
    ## 3   Continental    Regional        air          air k_Advection       Large
    ## 4      Moderate      Arctic        air          air k_Advection       Large
    ## 5      Moderate Continental        air          air k_Advection       Large
    ## 6      Moderate      Tropic        air          air k_Advection       Large
    ## 7      Regional Continental        air          air k_Advection       Large
    ## 8        Tropic    Moderate        air          air k_Advection       Large
    ## 9   Continental    Regional      river        river k_Advection       Large
    ## 10     Regional    Regional      river          sea k_Advection       Large
    ## 11  Continental Continental      river          sea k_Advection       Large
    ## 12     Regional    Regional       lake        river k_Advection       Large
    ## 13  Continental Continental       lake        river k_Advection       Large
    ## 14  Continental    Regional        sea          sea k_Advection       Large
    ## 15     Regional Continental        sea          sea k_Advection       Large
    ## 16       Arctic    Moderate        sea          sea k_Advection       Large
    ## 17       Arctic    Moderate  deepocean    deepocean k_Advection       Large
    ## 18  Continental    Moderate        sea          sea k_Advection       Large
    ## 19       Tropic    Moderate        sea          sea k_Advection       Large
    ## 20       Tropic    Moderate  deepocean    deepocean k_Advection       Large
    ## 21     Moderate      Tropic        sea          sea k_Advection       Large
    ## 22     Moderate      Tropic  deepocean    deepocean k_Advection       Large
    ## 23     Moderate      Arctic        sea          sea k_Advection       Large
    ## 24     Moderate      Arctic  deepocean    deepocean k_Advection       Large
    ## 25     Moderate Continental        sea          sea k_Advection       Large
    ## 26     Moderate    Moderate        sea    deepocean k_Advection       Large
    ## 27       Tropic      Tropic        sea    deepocean k_Advection       Large
    ## 28       Arctic      Arctic        sea    deepocean k_Advection       Large
    ## 29     Moderate    Moderate  deepocean          sea k_Advection       Large
    ## 30       Tropic      Tropic  deepocean          sea k_Advection       Large
    ## 31       Arctic      Arctic  deepocean          sea k_Advection       Large
    ## 32       Arctic    Moderate        air          air k_Advection       Small
    ## 33  Continental    Moderate        air          air k_Advection       Small
    ## 34  Continental    Regional        air          air k_Advection       Small
    ## 35     Moderate      Arctic        air          air k_Advection       Small
    ## 36     Moderate Continental        air          air k_Advection       Small
    ## 37     Moderate      Tropic        air          air k_Advection       Small
    ## 38     Regional Continental        air          air k_Advection       Small
    ## 39       Tropic    Moderate        air          air k_Advection       Small
    ## 40  Continental    Regional      river        river k_Advection       Small
    ## 41     Regional    Regional      river          sea k_Advection       Small
    ## 42  Continental Continental      river          sea k_Advection       Small
    ## 43     Regional    Regional       lake        river k_Advection       Small
    ## 44  Continental Continental       lake        river k_Advection       Small
    ## 45  Continental    Regional        sea          sea k_Advection       Small
    ## 46     Regional Continental        sea          sea k_Advection       Small
    ## 47       Arctic    Moderate        sea          sea k_Advection       Small
    ## 48       Arctic    Moderate  deepocean    deepocean k_Advection       Small
    ## 49  Continental    Moderate        sea          sea k_Advection       Small
    ## 50       Tropic    Moderate        sea          sea k_Advection       Small
    ## 51       Tropic    Moderate  deepocean    deepocean k_Advection       Small
    ## 52     Moderate      Tropic        sea          sea k_Advection       Small
    ## 53     Moderate      Tropic  deepocean    deepocean k_Advection       Small
    ## 54     Moderate      Arctic        sea          sea k_Advection       Small
    ## 55     Moderate      Arctic  deepocean    deepocean k_Advection       Small
    ## 56     Moderate Continental        sea          sea k_Advection       Small
    ## 57     Moderate    Moderate        sea    deepocean k_Advection       Small
    ## 58       Tropic      Tropic        sea    deepocean k_Advection       Small
    ## 59       Arctic      Arctic        sea    deepocean k_Advection       Small
    ## 60     Moderate    Moderate  deepocean          sea k_Advection       Small
    ## 61       Tropic      Tropic  deepocean          sea k_Advection       Small
    ## 62       Arctic      Arctic  deepocean          sea k_Advection       Small
    ## 63       Arctic    Moderate        air          air k_Advection       Solid
    ## 64  Continental    Moderate        air          air k_Advection       Solid
    ## 65  Continental    Regional        air          air k_Advection       Solid
    ## 66     Moderate      Arctic        air          air k_Advection       Solid
    ## 67     Moderate Continental        air          air k_Advection       Solid
    ## 68     Moderate      Tropic        air          air k_Advection       Solid
    ## 69     Regional Continental        air          air k_Advection       Solid
    ## 70       Tropic    Moderate        air          air k_Advection       Solid
    ## 71  Continental    Regional      river        river k_Advection       Solid
    ## 72     Regional    Regional      river          sea k_Advection       Solid
    ## 73  Continental Continental      river          sea k_Advection       Solid
    ## 74     Regional    Regional       lake        river k_Advection       Solid
    ## 75  Continental Continental       lake        river k_Advection       Solid
    ## 76  Continental    Regional        sea          sea k_Advection       Solid
    ## 77     Regional Continental        sea          sea k_Advection       Solid
    ## 78       Arctic    Moderate        sea          sea k_Advection       Solid
    ## 79       Arctic    Moderate  deepocean    deepocean k_Advection       Solid
    ## 80  Continental    Moderate        sea          sea k_Advection       Solid
    ## 81       Tropic    Moderate        sea          sea k_Advection       Solid
    ## 82       Tropic    Moderate  deepocean    deepocean k_Advection       Solid
    ## 83     Moderate      Tropic        sea          sea k_Advection       Solid
    ## 84     Moderate      Tropic  deepocean    deepocean k_Advection       Solid
    ## 85     Moderate      Arctic        sea          sea k_Advection       Solid
    ## 86     Moderate      Arctic  deepocean    deepocean k_Advection       Solid
    ## 87     Moderate Continental        sea          sea k_Advection       Solid
    ## 88     Moderate    Moderate        sea    deepocean k_Advection       Solid
    ## 89       Tropic      Tropic        sea    deepocean k_Advection       Solid
    ## 90       Arctic      Arctic        sea    deepocean k_Advection       Solid
    ## 91     Moderate    Moderate  deepocean          sea k_Advection       Solid
    ## 92       Tropic      Tropic  deepocean          sea k_Advection       Solid
    ## 93       Arctic      Arctic  deepocean          sea k_Advection       Solid
    ## 94       Arctic    Moderate        air          air k_Advection     Unbound
    ## 95  Continental    Moderate        air          air k_Advection     Unbound
    ## 96  Continental    Regional        air          air k_Advection     Unbound
    ## 97     Moderate      Arctic        air          air k_Advection     Unbound
    ## 98     Moderate Continental        air          air k_Advection     Unbound
    ## 99     Moderate      Tropic        air          air k_Advection     Unbound
    ## 100    Regional Continental        air          air k_Advection     Unbound
    ## 101      Tropic    Moderate        air          air k_Advection     Unbound
    ## 102 Continental    Regional      river        river k_Advection     Unbound
    ## 103    Regional    Regional      river          sea k_Advection     Unbound
    ## 104 Continental Continental      river          sea k_Advection     Unbound
    ## 105    Regional    Regional       lake        river k_Advection     Unbound
    ## 106 Continental Continental       lake        river k_Advection     Unbound
    ## 107 Continental    Regional        sea          sea k_Advection     Unbound
    ## 108    Regional Continental        sea          sea k_Advection     Unbound
    ## 109      Arctic    Moderate        sea          sea k_Advection     Unbound
    ## 110      Arctic    Moderate  deepocean    deepocean k_Advection     Unbound
    ## 111 Continental    Moderate        sea          sea k_Advection     Unbound
    ## 112      Tropic    Moderate        sea          sea k_Advection     Unbound
    ## 113      Tropic    Moderate  deepocean    deepocean k_Advection     Unbound
    ## 114    Moderate      Tropic        sea          sea k_Advection     Unbound
    ## 115    Moderate      Tropic  deepocean    deepocean k_Advection     Unbound
    ## 116    Moderate      Arctic        sea          sea k_Advection     Unbound
    ## 117    Moderate      Arctic  deepocean    deepocean k_Advection     Unbound
    ## 118    Moderate Continental        sea          sea k_Advection     Unbound
    ## 119    Moderate    Moderate        sea    deepocean k_Advection     Unbound
    ## 120      Tropic      Tropic        sea    deepocean k_Advection     Unbound
    ## 121      Arctic      Arctic        sea    deepocean k_Advection     Unbound
    ## 122    Moderate    Moderate  deepocean          sea k_Advection     Unbound
    ## 123      Tropic      Tropic  deepocean          sea k_Advection     Unbound
    ## 124      Arctic      Arctic  deepocean          sea k_Advection     Unbound
    ##     toSpecies       Volume
    ## 1       Large 4.249999e+16
    ## 2       Large 7.199998e+15
    ## 3       Large 7.199998e+15
    ## 4       Large 7.756998e+16
    ## 5       Large 7.756998e+16
    ## 6       Large 7.756998e+16
    ## 7       Large 2.299999e+14
    ## 8       Large 1.280000e+17
    ## 9       Large 2.875952e+11
    ## 10      Large 1.889235e+10
    ## 11      Large 2.875952e+11
    ## 12      Large 5.724953e+10
    ## 13      Large 8.715005e+11
    ## 14      Large 7.427996e+14
    ## 15      Large 1.001873e+10
    ## 16      Large 2.550000e+15
    ## 17      Large 7.650000e+16
    ## 18      Large 7.427996e+14
    ## 19      Large 8.960000e+15
    ## 20      Large 2.688000e+17
    ## 21      Large 3.878500e+15
    ## 22      Large 1.163550e+17
    ## 23      Large 3.878500e+15
    ## 24      Large 1.163550e+17
    ## 25      Large 3.878500e+15
    ## 26      Large 3.878500e+15
    ## 27      Large 8.960000e+15
    ## 28      Large 2.550000e+15
    ## 29      Large 1.163550e+17
    ## 30      Large 2.688000e+17
    ## 31      Large 7.650000e+16
    ## 32      Small 4.249999e+16
    ## 33      Small 7.199998e+15
    ## 34      Small 7.199998e+15
    ## 35      Small 7.756998e+16
    ## 36      Small 7.756998e+16
    ## 37      Small 7.756998e+16
    ## 38      Small 2.299999e+14
    ## 39      Small 1.280000e+17
    ## 40      Small 2.875952e+11
    ## 41      Small 1.889235e+10
    ## 42      Small 2.875952e+11
    ## 43      Small 5.724953e+10
    ## 44      Small 8.715005e+11
    ## 45      Small 7.427996e+14
    ## 46      Small 1.001873e+10
    ## 47      Small 2.550000e+15
    ## 48      Small 7.650000e+16
    ## 49      Small 7.427996e+14
    ## 50      Small 8.960000e+15
    ## 51      Small 2.688000e+17
    ## 52      Small 3.878500e+15
    ## 53      Small 1.163550e+17
    ## 54      Small 3.878500e+15
    ## 55      Small 1.163550e+17
    ## 56      Small 3.878500e+15
    ## 57      Small 3.878500e+15
    ## 58      Small 8.960000e+15
    ## 59      Small 2.550000e+15
    ## 60      Small 1.163550e+17
    ## 61      Small 2.688000e+17
    ## 62      Small 7.650000e+16
    ## 63      Solid 4.249999e+16
    ## 64      Solid 7.199998e+15
    ## 65      Solid 7.199998e+15
    ## 66      Solid 7.756998e+16
    ## 67      Solid 7.756998e+16
    ## 68      Solid 7.756998e+16
    ## 69      Solid 2.299999e+14
    ## 70      Solid 1.280000e+17
    ## 71      Solid 2.875952e+11
    ## 72      Solid 1.889235e+10
    ## 73      Solid 2.875952e+11
    ## 74      Solid 5.724953e+10
    ## 75      Solid 8.715005e+11
    ## 76      Solid 7.427996e+14
    ## 77      Solid 1.001873e+10
    ## 78      Solid 2.550000e+15
    ## 79      Solid 7.650000e+16
    ## 80      Solid 7.427996e+14
    ## 81      Solid 8.960000e+15
    ## 82      Solid 2.688000e+17
    ## 83      Solid 3.878500e+15
    ## 84      Solid 1.163550e+17
    ## 85      Solid 3.878500e+15
    ## 86      Solid 1.163550e+17
    ## 87      Solid 3.878500e+15
    ## 88      Solid 3.878500e+15
    ## 89      Solid 8.960000e+15
    ## 90      Solid 2.550000e+15
    ## 91      Solid 1.163550e+17
    ## 92      Solid 2.688000e+17
    ## 93      Solid 7.650000e+16
    ## 94    Unbound 4.249999e+16
    ## 95    Unbound 7.199998e+15
    ## 96    Unbound 7.199998e+15
    ## 97    Unbound 7.756998e+16
    ## 98    Unbound 7.756998e+16
    ## 99    Unbound 7.756998e+16
    ## 100   Unbound 2.299999e+14
    ## 101   Unbound 1.280000e+17
    ## 102   Unbound 2.875952e+11
    ## 103   Unbound 1.889235e+10
    ## 104   Unbound 2.875952e+11
    ## 105   Unbound 5.724953e+10
    ## 106   Unbound 8.715005e+11
    ## 107   Unbound 7.427996e+14
    ## 108   Unbound 1.001873e+10
    ## 109   Unbound 2.550000e+15
    ## 110   Unbound 7.650000e+16
    ## 111   Unbound 7.427996e+14
    ## 112   Unbound 8.960000e+15
    ## 113   Unbound 2.688000e+17
    ## 114   Unbound 3.878500e+15
    ## 115   Unbound 1.163550e+17
    ## 116   Unbound 3.878500e+15
    ## 117   Unbound 1.163550e+17
    ## 118   Unbound 3.878500e+15
    ## 119   Unbound 3.878500e+15
    ## 120   Unbound 8.960000e+15
    ## 121   Unbound 2.550000e+15
    ## 122   Unbound 1.163550e+17
    ## 123   Unbound 2.688000e+17
    ## 124   Unbound 7.650000e+16

``` r
#for testing use:
testProc$execute()
```

    ## Warning in private$Execute(debugAt): input data ignored; not all Volume in
    ## FromAndTo property

    ##       fromScale     toScale fromSubCompart toSubCompart     process fromSpecies
    ## 1        Arctic      Arctic      deepocean          sea k_Advection       Large
    ## 2        Arctic      Arctic      deepocean          sea k_Advection       Small
    ## 3        Arctic      Arctic      deepocean          sea k_Advection       Solid
    ## 4        Arctic      Arctic      deepocean          sea k_Advection     Unbound
    ## 5        Arctic      Arctic            sea    deepocean k_Advection     Unbound
    ## 6        Arctic      Arctic            sea    deepocean k_Advection       Large
    ## 7        Arctic      Arctic            sea    deepocean k_Advection       Small
    ## 8        Arctic      Arctic            sea    deepocean k_Advection       Solid
    ## 9        Arctic    Moderate            air          air k_Advection       Large
    ## 10       Arctic    Moderate            air          air k_Advection       Small
    ## 11       Arctic    Moderate            air          air k_Advection       Solid
    ## 12       Arctic    Moderate            air          air k_Advection     Unbound
    ## 13       Arctic    Moderate      deepocean    deepocean k_Advection       Solid
    ## 14       Arctic    Moderate      deepocean    deepocean k_Advection     Unbound
    ## 15       Arctic    Moderate      deepocean    deepocean k_Advection       Large
    ## 16       Arctic    Moderate      deepocean    deepocean k_Advection       Small
    ## 17       Arctic    Moderate            sea          sea k_Advection       Solid
    ## 18       Arctic    Moderate            sea          sea k_Advection     Unbound
    ## 19       Arctic    Moderate            sea          sea k_Advection       Large
    ## 20       Arctic    Moderate            sea          sea k_Advection       Small
    ## 21  Continental Continental           lake        river k_Advection       Solid
    ## 22  Continental Continental           lake        river k_Advection       Small
    ## 23  Continental Continental           lake        river k_Advection     Unbound
    ## 24  Continental Continental           lake        river k_Advection       Large
    ## 25  Continental Continental          river          sea k_Advection       Solid
    ## 26  Continental Continental          river          sea k_Advection     Unbound
    ## 27  Continental Continental          river          sea k_Advection       Small
    ## 28  Continental Continental          river          sea k_Advection       Large
    ## 29  Continental    Moderate            air          air k_Advection       Small
    ## 30  Continental    Moderate            air          air k_Advection       Solid
    ## 31  Continental    Moderate            air          air k_Advection     Unbound
    ## 32  Continental    Moderate            air          air k_Advection       Large
    ## 33  Continental    Moderate            sea          sea k_Advection       Large
    ## 34  Continental    Moderate            sea          sea k_Advection       Small
    ## 35  Continental    Moderate            sea          sea k_Advection     Unbound
    ## 36  Continental    Moderate            sea          sea k_Advection       Solid
    ## 37  Continental    Regional            air          air k_Advection       Small
    ## 38  Continental    Regional            air          air k_Advection       Solid
    ## 39  Continental    Regional            air          air k_Advection     Unbound
    ## 40  Continental    Regional            air          air k_Advection       Large
    ## 41  Continental    Regional          river        river k_Advection       Solid
    ## 42  Continental    Regional          river        river k_Advection       Large
    ## 43  Continental    Regional          river        river k_Advection     Unbound
    ## 44  Continental    Regional          river        river k_Advection       Small
    ## 45  Continental    Regional            sea          sea k_Advection       Small
    ## 46  Continental    Regional            sea          sea k_Advection       Large
    ## 47  Continental    Regional            sea          sea k_Advection       Solid
    ## 48  Continental    Regional            sea          sea k_Advection     Unbound
    ## 49     Moderate      Arctic            air          air k_Advection       Small
    ## 50     Moderate      Arctic            air          air k_Advection       Solid
    ## 51     Moderate      Arctic            air          air k_Advection     Unbound
    ## 52     Moderate      Arctic            air          air k_Advection       Large
    ## 53     Moderate      Arctic      deepocean    deepocean k_Advection     Unbound
    ## 54     Moderate      Arctic      deepocean    deepocean k_Advection       Large
    ## 55     Moderate      Arctic      deepocean    deepocean k_Advection       Small
    ## 56     Moderate      Arctic      deepocean    deepocean k_Advection       Solid
    ## 57     Moderate      Arctic            sea          sea k_Advection       Solid
    ## 58     Moderate      Arctic            sea          sea k_Advection       Large
    ## 59     Moderate      Arctic            sea          sea k_Advection     Unbound
    ## 60     Moderate      Arctic            sea          sea k_Advection       Small
    ## 61     Moderate Continental            air          air k_Advection       Large
    ## 62     Moderate Continental            air          air k_Advection     Unbound
    ## 63     Moderate Continental            air          air k_Advection       Small
    ## 64     Moderate Continental            air          air k_Advection       Solid
    ## 65     Moderate Continental            sea          sea k_Advection     Unbound
    ## 66     Moderate Continental            sea          sea k_Advection       Large
    ## 67     Moderate Continental            sea          sea k_Advection       Small
    ## 68     Moderate Continental            sea          sea k_Advection       Solid
    ## 69     Moderate    Moderate      deepocean          sea k_Advection     Unbound
    ## 70     Moderate    Moderate      deepocean          sea k_Advection       Large
    ## 71     Moderate    Moderate      deepocean          sea k_Advection       Small
    ## 72     Moderate    Moderate      deepocean          sea k_Advection       Solid
    ## 73     Moderate    Moderate            sea    deepocean k_Advection       Large
    ## 74     Moderate    Moderate            sea    deepocean k_Advection     Unbound
    ## 75     Moderate    Moderate            sea    deepocean k_Advection       Small
    ## 76     Moderate    Moderate            sea    deepocean k_Advection       Solid
    ## 77     Moderate      Tropic            air          air k_Advection       Small
    ## 78     Moderate      Tropic            air          air k_Advection       Solid
    ## 79     Moderate      Tropic            air          air k_Advection       Large
    ## 80     Moderate      Tropic            air          air k_Advection     Unbound
    ## 81     Moderate      Tropic      deepocean    deepocean k_Advection       Solid
    ## 82     Moderate      Tropic      deepocean    deepocean k_Advection     Unbound
    ## 83     Moderate      Tropic      deepocean    deepocean k_Advection       Small
    ## 84     Moderate      Tropic      deepocean    deepocean k_Advection       Large
    ## 85     Moderate      Tropic            sea          sea k_Advection     Unbound
    ## 86     Moderate      Tropic            sea          sea k_Advection       Solid
    ## 87     Moderate      Tropic            sea          sea k_Advection       Large
    ## 88     Moderate      Tropic            sea          sea k_Advection       Small
    ## 89     Regional Continental            air          air k_Advection       Small
    ## 90     Regional Continental            air          air k_Advection       Solid
    ## 91     Regional Continental            air          air k_Advection     Unbound
    ## 92     Regional Continental            air          air k_Advection       Large
    ## 93     Regional Continental            sea          sea k_Advection       Solid
    ## 94     Regional Continental            sea          sea k_Advection     Unbound
    ## 95     Regional Continental            sea          sea k_Advection       Large
    ## 96     Regional Continental            sea          sea k_Advection       Small
    ## 97     Regional    Regional           lake        river k_Advection     Unbound
    ## 98     Regional    Regional           lake        river k_Advection       Solid
    ## 99     Regional    Regional           lake        river k_Advection       Small
    ## 100    Regional    Regional           lake        river k_Advection       Large
    ## 101    Regional    Regional          river          sea k_Advection     Unbound
    ## 102    Regional    Regional          river          sea k_Advection       Solid
    ## 103    Regional    Regional          river          sea k_Advection       Large
    ## 104    Regional    Regional          river          sea k_Advection       Small
    ## 105      Tropic    Moderate            air          air k_Advection       Small
    ## 106      Tropic    Moderate            air          air k_Advection       Solid
    ## 107      Tropic    Moderate            air          air k_Advection     Unbound
    ## 108      Tropic    Moderate            air          air k_Advection       Large
    ## 109      Tropic    Moderate      deepocean    deepocean k_Advection     Unbound
    ## 110      Tropic    Moderate      deepocean    deepocean k_Advection       Solid
    ## 111      Tropic    Moderate      deepocean    deepocean k_Advection       Small
    ## 112      Tropic    Moderate      deepocean    deepocean k_Advection       Large
    ## 113      Tropic    Moderate            sea          sea k_Advection     Unbound
    ## 114      Tropic    Moderate            sea          sea k_Advection       Large
    ## 115      Tropic    Moderate            sea          sea k_Advection       Solid
    ## 116      Tropic    Moderate            sea          sea k_Advection       Small
    ## 117      Tropic      Tropic      deepocean          sea k_Advection     Unbound
    ## 118      Tropic      Tropic      deepocean          sea k_Advection       Large
    ## 119      Tropic      Tropic      deepocean          sea k_Advection       Small
    ## 120      Tropic      Tropic      deepocean          sea k_Advection       Solid
    ## 121      Tropic      Tropic            sea    deepocean k_Advection       Small
    ## 122      Tropic      Tropic            sea    deepocean k_Advection       Solid
    ## 123      Tropic      Tropic            sea    deepocean k_Advection       Large
    ## 124      Tropic      Tropic            sea    deepocean k_Advection     Unbound
    ##     toSpecies            k
    ## 1       Large 8.975375e-09
    ## 2       Small 8.975375e-09
    ## 3       Solid 8.975375e-09
    ## 4     Unbound 8.975375e-09
    ## 5     Unbound 2.692612e-07
    ## 6       Large 2.692612e-07
    ## 7       Small 2.692612e-07
    ## 8       Solid 2.692612e-07
    ## 9       Large 6.923419e-07
    ## 10      Small 6.923419e-07
    ## 11      Solid 6.923419e-07
    ## 12    Unbound 6.923419e-07
    ## 13      Solid 1.960784e-09
    ## 14    Unbound 1.960784e-09
    ## 15      Large 1.960784e-09
    ## 16      Small 1.960784e-09
    ## 17      Solid 0.000000e+00
    ## 18    Unbound 0.000000e+00
    ## 19      Large 0.000000e+00
    ## 20      Small 0.000000e+00
    ## 21      Solid 2.397260e-09
    ## 22      Small 2.397260e-09
    ## 23    Unbound 2.397260e-09
    ## 24      Large 2.397260e-09
    ## 25      Solid 7.264425e-08
    ## 26    Unbound 7.264425e-08
    ## 27      Small 7.264425e-08
    ## 28      Large 7.264425e-08
    ## 29      Small 1.381449e-06
    ## 30      Solid 1.381449e-06
    ## 31    Unbound 1.381449e-06
    ## 32      Large 1.381449e-06
    ## 33      Large 3.169132e-08
    ## 34      Small 3.169132e-08
    ## 35    Unbound 3.169132e-08
    ## 36      Solid 3.169132e-08
    ## 37      Small 3.006398e-07
    ## 38      Solid 3.006398e-07
    ## 39    Unbound 3.006398e-07
    ## 40      Large 3.006398e-07
    ## 41      Solid 0.000000e+00
    ## 42      Large 0.000000e+00
    ## 43    Unbound 0.000000e+00
    ## 44      Small 0.000000e+00
    ## 45      Small 1.662869e-11
    ## 46      Large 1.662869e-11
    ## 47      Solid 1.662869e-11
    ## 48    Unbound 1.662869e-11
    ## 49      Small 3.793287e-07
    ## 50      Solid 3.793287e-07
    ## 51    Unbound 3.793287e-07
    ## 52      Large 3.793287e-07
    ## 53    Unbound 0.000000e+00
    ## 54      Large 0.000000e+00
    ## 55      Small 0.000000e+00
    ## 56      Solid 0.000000e+00
    ## 57      Solid 3.867475e-08
    ## 58      Large 3.867475e-08
    ## 59    Unbound 3.867475e-08
    ## 60      Small 3.867475e-08
    ## 61      Large 1.282252e-07
    ## 62    Unbound 1.282252e-07
    ## 63      Small 1.282252e-07
    ## 64      Solid 1.282252e-07
    ## 65    Unbound 6.069433e-09
    ## 66      Large 6.069433e-09
    ## 67      Small 6.069433e-09
    ## 68      Solid 6.069433e-09
    ## 69    Unbound 8.303749e-09
    ## 70      Large 8.303749e-09
    ## 71      Small 8.303749e-09
    ## 72      Solid 8.303749e-09
    ## 73      Large 2.491125e-07
    ## 74    Unbound 2.491125e-07
    ## 75      Small 2.491125e-07
    ## 76      Solid 2.491125e-07
    ## 77      Small 6.583036e-07
    ## 78      Solid 6.583036e-07
    ## 79      Large 6.583036e-07
    ## 80    Unbound 6.583036e-07
    ## 81      Solid 1.289158e-09
    ## 82    Unbound 1.289158e-09
    ## 83      Small 1.289158e-09
    ## 84      Large 1.289158e-09
    ## 85    Unbound 0.000000e+00
    ## 86      Solid 0.000000e+00
    ## 87      Large 0.000000e+00
    ## 88      Small 0.000000e+00
    ## 89      Small 9.411333e-06
    ## 90      Solid 9.411333e-06
    ## 91    Unbound 9.411333e-06
    ## 92      Large 9.411333e-06
    ## 93      Solid 1.369854e-06
    ## 94    Unbound 1.369854e-06
    ## 95      Large 1.369854e-06
    ## 96      Small 1.369854e-06
    ## 97    Unbound 2.397260e-09
    ## 98      Solid 2.397260e-09
    ## 99      Small 2.397260e-09
    ## 100     Large 2.397260e-09
    ## 101   Unbound 7.264425e-08
    ## 102     Solid 7.264425e-08
    ## 103     Large 7.264425e-08
    ## 104     Small 7.264425e-08
    ## 105     Small 3.989423e-07
    ## 106     Solid 3.989423e-07
    ## 107   Unbound 3.989423e-07
    ## 108     Large 3.989423e-07
    ## 109   Unbound 0.000000e+00
    ## 110     Solid 0.000000e+00
    ## 111     Small 0.000000e+00
    ## 112     Large 0.000000e+00
    ## 113   Unbound 1.674107e-08
    ## 114     Large 1.674107e-08
    ## 115     Solid 1.674107e-08
    ## 116     Small 1.674107e-08
    ## 117   Unbound 7.572626e-09
    ## 118     Large 7.572626e-09
    ## 119     Small 7.572626e-09
    ## 120     Solid 7.572626e-09
    ## 121     Small 2.271788e-07
    ## 122     Solid 2.271788e-07
    ## 123     Large 2.271788e-07
    ## 124   Unbound 2.271788e-07
