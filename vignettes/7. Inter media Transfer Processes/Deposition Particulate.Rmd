---
title: "Particulate Deposition air to soil/water"
date: "`r Sys.Date()`"
output: github_document
editor_options: 
  chunk_output_type: console
---

```{r setup}
# knitr::opts_chunk$set(echo = TRUE)
# projectRoot <- paste(getwd(), "..", sep = "/")
# knitr::opts_knit$set(root.dir = NULL) #assuming vignette is in a direct subfolder of the project


# knitr::opts_knit$get()
```


```{r message=FALSE, warning=FALSE, paged.print=FALSE}

# knitr::opts_chunk$set(echo = TRUE)
# projectRoot <- paste(getwd(), "..", sep = "/")
# knitr::opts_knit$set(root.dir = projectRoot) #assuming vignette is in a direct subfolder of the project

# see which relevant substances are in the database:
library(tidyverse)
SubstanceDatabase <- read.csv("data/Substances.csv")
# unique(as.tibble(SubstanceDatabase$ChemClass))
SubstanceDatabase |> filter(ChemClass == "particle")

rm(substance) #for "default substance", example of neutral substance
substance <- "nAg_10nm"
#substance <- "organic acid" #example of acid
#substance <- "organic base" #example of base
#substance <- "Ag(I)" #example of metal

source("baseScripts/initTestWorld.R")

```

## Introduction

See if the following variable are available. They are required for the DryDeposition function

to.Area, from.Volume, AEROresist, Diffusivity,
                          DynVisc,rhoMatrix,ColRad,rad_species,rho_species,
                          Temp,to.alpha.surf, Cunningham, SetVel

```{r paged.print=TRUE}

World$fetchData("Area")
World$fetchData("Volume")
World$fetchData("AEROresist")
World$fetchData("Matrix")
#Diffusivity is calculated based on f_Diffusivity

World$fetchData("DynVisc")
World$fetchData("rhoMatrix")
World$fetchData("ColRad")

World$NewCalcVariable("rad_species")
World$CalcVar("rad_species")
World$NewCalcVariable("rho_species")
World$CalcVar("rho_species")

World$fetchData("Temp")
World$fetchData("alpha.surf")
# Cunningham calculated using f_Cunningham

World$NewCalcVariable("SettlingVelocity")
World$CalcVar("SettlingVelocity")

World$fetchData("gamma.surf")
World$fetchData("FricVel")
World$fetchData("SubCompartName")


```


## Calculation of Dry Deposition rate constant for particulates

The implementation follows the LOTOS-EUROS v2.0 2016 guidance for dry deposition of particles. This does mean there might be small deviations from the current implementation in SimpleBox4nano xlsx.

```{r k_DryDeposition, warning=FALSE, paged.print=TRUE}

World$FromDataAndTo("k_DryDeposition")
testProc <- World$NewProcess("k_DryDeposition")
testProc$execute()

```

## Calculation of Wet Deposition rate constant for particulates

```{r k_CWscavenging}

# #init default core (World) with classic states, and classic kaas
# substance <- "nAg_10nm"  #use a nano material, otherwise it only encounters Molecular
# excelReference <- "data/20210331 SimpleBox4nano_rev006.xlsx"
# source("baseScripts/initTestWorld.R")
# 
# lapply(c("rho_species", "rad_species"), function(FuName){
#   World$NewCalcVariable(FuName)
#   World$CalcVar(FuName)
# })
# World$fetchData("Temp")

World$fetchData("NaturalRho")
World$fetchData("SettlingVelocity") 
World$fetchData("rhoMatrix")
World$fetchData("RAINrate")
World$fetchData("FRACtwet")
World$fetchData("tdry")
World$fetchData("twet")
World$fetchData("COLLECTeff")

World$FromDataAndTo("k_CWscavenging")
testProc <- World$NewProcess("k_CWscavenging")
debugonce(k_CWscavenging)
testProc$execute(debugAt = list(Scale = "Regional"))
testProc$execute()
debug(testProc$execute())

#calculation of kaas is by executing a process
testClass <- World$NewProcess("k_CWscavenging")
testClass$execute(list())



# debug(testClass$execute)
# testClass$execute(debugAt = list()) #an empty list always triggers
#testVar$execute(debugAt = list(Scale = "Regional", SubCompart = "air"))

```

