---
title: "sb oo data"
author: "JS"
date: "15 Mar 2022"
output: github_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::knit_meta()
knitr::opts_chunk$set(echo = TRUE)
projectRoot <- paste(getwd(), "..", sep = "/")
knitr::opts_knit$set(root.dir = projectRoot) #assuming vignette is in a direct subfolder of the project
```

## Documentation / metadata
Documentation of the data is basically in the same table as the units. This means ALL variables should be in the list. It takes quite some discipline to maintain this documentation. It might help to run a script like below, to check how complete the units-table is.
```{r}
#We need to initialize for a nano material to obtain all properties, including those only needed for nanomaterials
substance <- "nAg_10nm"
#Initialize World, but also the object NewstateModule. This object you don't use, normally. 
#It is internal, exposed through "injection" into World
source("baseScripts/initTestWorld.R")
AllVarnames <- World$fetchData() 
#There should be 1 place (table) for a variable; are there multiple?
table(AllVarnames)[table(AllVarnames)!=1]
#Columns of the QSAR table are an exception, can be ignored here...
#Also ignore variable-names starting with k_. The are the exceptions to the described process from-and-to data
#Also ignore variable starting with Abbr, these are for old (excel) variable naming convention
#Also ignore "Waarde", "Dimension", "forWhich" and "unit", other technicalities...
AllVarnames <- AllVarnames[!startsWith(AllVarnames, prefix = "k_") & 
                             !startsWith(AllVarnames, prefix = "Abbr") &
                             !startsWith(AllVarnames, prefix = "outdated")]
AllVarnames <- AllVarnames[!AllVarnames %in% c("VarName", "Waarde", "Dimension", "forWhich", "Unit", "table")] 
#compare to the units table; which has been read into the World by 
UnitTable <- NewstateModule$SB4N.data[["Units"]]

unique(AllVarnames)[!AllVarnames %in% UnitTable$VarName]
```
## Update Units table == Adding and Deleting

We determined the variables missing in Units; but if we overwrite the current csv file, (old) variables will be deleted; is the user sure?

```{r}
UnitTable$VarName[!UnitTable$VarName %in% unique(AllVarnames)]
```
If everything looks honky dori, we can find the table/sheet/csv filename for each new variable add it to the units dataframe and overwrite the existing data...

```{r}
#The trail of variables is stored when reading it originally; in 
NewUnits <- left_join(UnitTable, NewstateModule$varOrigine)
AlfOrder <- order(NewUnits$VarName)
write.csv(NewUnits[AlfOrder,], file = "data/Units.csv")
# source("baseScripts/ReorderCSV.R") not needed because already alphabetic
```

## The constants package
Some global constants are imported from this package. For convenience two functions are availeable, demonstrated below.
```{r}
getConst("r")
```
```{r}
ConstGrep("gravity")
# we were loooking for getConst("gn")
```

Happy calculations!
